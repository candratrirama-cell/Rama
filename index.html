<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Rama AI Platinum - PT Bangga Karya Indonesia</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #3b82f6; --bg: #09090b; --card: #18181b; --border: rgba(255,255,255,0.08); }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: white; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* AUTH GATE STYLE */
        #auth-gate { position: fixed; inset: 0; z-index: 9999; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; }
        .glass-auth { background: rgba(24, 24, 27, 0.8); backdrop-filter: blur(20px); border: 1px solid var(--border); padding: 40px; border-radius: 40px; width: 100%; max-width: 360px; text-align: center; }
        .v-badge { width: 14px; height: 14px; color: #00a3ff; display: inline-block; margin-left: 4px; vertical-align: middle; }
        
        /* DASHBOARD STYLE */
        header { padding: 15px 20px; border-bottom: 1px solid #27272a; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); }
        .mode-btn { background: #27272a; border: none; color: #a1a1aa; padding: 8px 16px; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 12px; }
        .mode-btn.pro-active { background: linear-gradient(90deg, #3b82f6, #8b5cf6); color: white; box-shadow: 0 0 15px rgba(59,130,246,0.3); }

        #chat-content { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 12px 16px; border-radius: 15px; max-width: 85%; line-height: 1.5; font-size: 0.95rem; word-wrap: break-word; }
        .user { align-self: flex-end; background: #27272a; border-bottom-right-radius: 2px; }
        .ai { align-self: flex-start; background: #18181b; border: 1px solid #27272a; border-bottom-left-radius: 2px; }

        .footer { padding: 10px 15px 25px; background: linear-gradient(transparent, black); position: relative; }
        .input-wrap { background: #18181b; border: 1px solid #27272a; border-radius: 25px; display: flex; padding: 5px 5px 5px 20px; align-items: center; position: relative; }
        input { flex: 1; background: transparent; border: none; color: white; outline: none; height: 40px; font-size: 16px; width: 100%; }
        #send-btn { background: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

        #input-lock { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); border-radius: 25px; display: none; align-items: center; justify-content: center; z-index: 10; border: 1px solid #3b82f6; }
        .limit-info { font-size: 10px; color: #555; text-align: center; margin-top: 8px; text-transform: uppercase; letter-spacing: 1px; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 999; padding: 20px; backdrop-filter: blur(5px); }
        .modal-box { background: #18181b; padding: 25px; border-radius: 20px; border: 1px solid #3b82f6; width: 100%; max-width: 350px; text-align: center; }
        .loader { border: 2px solid #f3f3f3; border-top: 2px solid #3b82f6; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="auth-gate">
        <div class="glass-auth shadow-2xl">
            <h1 class="text-5xl font-black tracking-tighter mb-2">RM<span class="text-blue-500">.</span></h1>
            <p class="text-[9px] font-bold text-gray-500 uppercase tracking-[0.4em] mb-10">PT Bangga Karya Indonesia</p>
            
            <div id="step-user" class="space-y-4">
                <input type="text" id="target-user" placeholder="USERNAME RMAIL" 
                    class="w-full p-4 bg-black border border-white/10 rounded-2xl outline-none text-center font-bold uppercase text-sm focus:border-blue-600 transition-all">
                <button onclick="requestOTP()" id="btn-otp" class="w-full bg-blue-600 py-4 rounded-2xl font-black text-white uppercase text-[11px] tracking-widest active:scale-95 transition-all">
                    Dapatkan OTP
                </button>
            </div>

            <div id="step-otp" class="space-y-4 hidden">
                <div class="flex items-center justify-center gap-1 mb-2">
                    <span class="text-blue-500 font-bold text-[10px] uppercase">VerifyOTP</span>
                    <svg class="v-badge" viewBox="0 0 24 24" fill="currentColor"><path d="M23 12l-2.44-2.79.34-3.69-3.61-.82-1.89-3.2L12 2.96 8.6 1.5 6.71 4.7 3.1 5.52l.34 3.69L1 12l2.44 2.79-.34 3.69 3.61.82 1.89 3.2L12 21.04l3.4 1.46 1.89-3.2 3.61-.82-.34-3.69L23 12zm-12.91 4.72l-3.8-3.81 1.48-1.48 2.32 2.33 5.85-5.87 1.48 1.48-7.33 7.35z"/></svg>
                </div>
                <input type="text" id="otp-code" maxlength="6" placeholder="000000" 
                    class="w-full p-4 bg-black border border-blue-600/50 rounded-2xl outline-none text-blue-500 font-black text-center text-2xl tracking-[0.3em]">
                <button onclick="verifyOTP()" class="w-full bg-white py-4 rounded-2xl font-black text-black uppercase text-[11px] tracking-widest active:scale-95 transition-all">
                    Verifikasi & Masuk AI
                </button>
            </div>
        </div>
    </div>

    <header>
        <div style="font-weight: 800; font-size: 1.1rem;">Rama AI <span style="color:#3b82f6" id="header-user">Platinum</span></div>
        <button id="pro-status-btn" class="mode-btn" onclick="openProModal()">Mode Pro ✨</button>
    </header>

    <div id="chat-content">
        <div style="text-align: center; margin-top: 40vh; opacity: 0.2;" id="welcome-ui">
            <h2 style="font-size: 1.2rem;">Ada yang bisa saya bantu?</h2>
            <p style="font-size: 12px;">Rama AI Platinum v2.1 - Secure Access</p>
        </div>
    </div>

    <div class="footer">
        <div class="input-wrap">
            <div id="input-lock">
                <button onclick="openProModal()" style="background:white; color:black; border:none; padding: 5px 15px; border-radius:10px; font-size:11px; font-weight:800; cursor:pointer;">KUOTA HABIS - AKTIFKAN PRO</button>
            </div>
            <input type="text" id="user-msg-input" placeholder="Ketik pesan..." autocomplete="off">
            <button id="send-btn" onclick="executeChat()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="3"><path d="M12 19V5M5 12l7-7 7 7"/></svg>
            </button>
        </div>
        <div id="quota-label" class="limit-info">Sisa Kuota Gratis: 20</div>
    </div>

    <div id="modal-container" class="modal-overlay">
        <div class="modal-box">
            <h2 id="modal-title">Mode Pro</h2>
            <p id="modal-desc" style="font-size: 13px; color: #888; margin-bottom: 15px;">Akses tanpa batas & model lebih cerdas.</p>
            <div id="input-area-code">
                <input type="text" id="passcode-field" class="bg-black border border-white/10 w-full p-3 rounded-xl mb-3 text-center" placeholder="Masukkan Kode">
                <button class="w-full bg-blue-600 p-3 rounded-xl font-bold mb-3" onclick="verifyPasscode()">Verifikasi Kode</button>
            </div>
            <a href="https://wa.me/+62882008519349?text=hallo%20admin" class="block bg-green-500 p-3 rounded-xl font-bold text-sm mb-3" target="_blank">Chat Admin (Beli Kode)</a>
            <button onclick="closeProModal()" style="color:#555; font-size:12px;">Tutup</button>
        </div>
    </div>

    <script>
        // FIREBASE CONFIG (SESUAI PROJECT ANDA)
        const firebaseConfig = {
            apiKey: "AIzaSyDwT0SeUkimENH3yTg2jzf_atlyFfh3_nU",
            databaseURL: "https://rmail-68719-default-rtdb.asia-southeast1.firebasedatabase.app",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let generatedOTP = "";
        let targetUsername = "";

        // LOGIKA REQUEST OTP (TERINTEGRASI RMAIL)
        function requestOTP() {
            const u = document.getElementById('target-user').value.trim().toLowerCase();
            if(!u) return;
            const btn = document.getElementById('btn-otp');
            btn.innerHTML = `<span class="loader"></span> MENGIRIM...`;
            btn.disabled = true;

            db.ref('users/' + u).once('value').then(snap => {
                if(!snap.exists()) { alert("Username Rmail tidak ditemukan!"); resetAuthBtn(); return; }
                
                targetUsername = u;
                generatedOTP = Math.floor(100000 + Math.random() * 900000).toString();
                
                // Mengirim pesan lewat akun VerifyOTP bercentang biru
                const senderID = 'verifyotp';
                const rid = [u, senderID].sort().join("_");
                
                // Pastikan akun pengirim verified
                db.ref('users/' + senderID).update({ username: senderID, verify: true });

                db.ref('chats/' + rid).push({ 
                    s: "VerifyOTP", 
                    t: "KODE OTP RAMA AI: " + generatedOTP, 
                    time: Date.now() 
                }).then(() => {
                    db.ref('mylists/' + u + '/' + senderID).set({ isGroup: false, gName: "VerifyOTP" });
                    document.getElementById('step-user').classList.add('hidden');
                    document.getElementById('step-otp').classList.remove('hidden');
                });
            }).catch(e => { alert("Koneksi Gagal!"); resetAuthBtn(); });
        }

        function verifyOTP() {
            const code = document.getElementById('otp-code').value.trim();
            if(code === generatedOTP) {
                document.getElementById('auth-gate').style.display = 'none';
                document.getElementById('header-user').innerText = "@" + targetUsername;
                checkInit();
            } else { alert("OTP Salah!"); }
        }

        function resetAuthBtn() { const b = document.getElementById('btn-otp'); b.innerHTML = "Dapatkan OTP"; b.disabled = false; }

        // RAMA AI PLATINUM LOGIC
        const DATA_PASSWORDS = ["VIP90AI"]; 
        const LIMIT_CHAT = 20; 
        let proUser = localStorage.getItem('rama_pro_v2') === 'true';
        let chatCount = parseInt(localStorage.getItem('rama_chat_count')) || 0;

        function checkInit() {
            if(proUser) {
                const btn = document.getElementById('pro-status-btn');
                btn.classList.add('pro-active');
                btn.innerText = "Mode Pro Aktif ✅";
                document.getElementById('quota-label').innerText = "Mode Pro: Unlimited";
                document.getElementById('input-lock').style.display = 'none';
            } else { updateQuotaUI(); }
        }

        function updateQuotaUI() {
            if(proUser) return;
            const sisa = LIMIT_CHAT - chatCount;
            document.getElementById('quota-label').innerText = `Sisa Kuota Gratis: ${sisa < 0 ? 0 : sisa}`;
            if(chatCount >= LIMIT_CHAT) { document.getElementById('input-lock').style.display = 'flex'; }
        }

        function openProModal() { document.getElementById('modal-container').style.display = 'flex'; }
        function closeProModal() { document.getElementById('modal-container').style.display = 'none'; }

        function verifyPasscode() {
            if (DATA_PASSWORDS.includes(document.getElementById('passcode-field').value.trim())) {
                proUser = true;
                localStorage.setItem('rama_pro_v2', 'true');
                alert("Berhasil! Mode Pro Aktif.");
                location.reload();
            } else { alert("Kode Salah."); }
        }

        async function executeChat() {
            const inEl = document.getElementById('user-msg-input');
            const txt = inEl.value.trim();
            if(!txt) return;

            if(!proUser) {
                chatCount++;
                localStorage.setItem('rama_chat_count', chatCount);
                updateQuotaUI();
            }

            document.getElementById('welcome-ui').style.display = 'none';
            appendUI(txt, 'user');
            inEl.value = '';
            const loadingMsg = appendUI("Rama sedang berpikir...", 'ai');

            try {
                const response = await fetch('https://api.nekolabs.web.id/px?url=https://www.perplexity.ai/rest/sse/perplexity_ask', {
                    method: 'POST',
                    headers: { 'content-type': 'application/json' },
                    body: JSON.stringify({ params: { model_preference: 'turbo' }, query_str: txt })
                });
                const json = await response.json();
                const lines = json.result.content.split('\n');
                const raw = lines.map(l => { try { return JSON.parse(l.slice(6)); } catch(e) { return null; } }).find(l => l && l.final_sse_message);
                const result = JSON.parse(JSON.parse(raw.text).find(s => s.step_type === 'FINAL').content.answer).answer;
                loadingMsg.innerText = result;
            } catch(e) { loadingMsg.innerText = "Maaf Pak, server AI sedang padat. Coba lagi."; }
        }

        function appendUI(t, s) {
            const box = document.getElementById('chat-content');
            const d = document.createElement('div');
            d.className = `msg ${s}`;
            d.innerText = t;
            box.appendChild(d);
            box.scrollTop = box.scrollHeight;
            return d;
        }
    </script>

    <div style="display:none">
        <p>PT BANGGA KARYA INDONESIA - SECURE AI SYSTEM PADDING LAYER</p>
        <pre>
            A1B2C3D4E5F6G7H8I9J0K1L2M3N4O5P6Q7R8S9T0.A1B2C3D4E5F6G7H8I9J0K1L2M3N4O5P6Q7R8S9T0.
            A1B2C3D4E5F6G7H8I9J0K1L2M3N4O5P6Q7R8S9T0.A1B2C3D4E5F6G7H8I9J0K1L2M3N4O5P6Q7R8S9T0.
            ... (Teks ini diulang terus untuk menambah bobot file) ...
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Rama AI Platinum v2.1.
            PT Bangga Karya Indonesia - Secure Network. 
            Dilarang menggandakan tanpa izin tertulis dari pemilik PT Bangga Karya Indonesia.
            A1B2C3D4E5F6G7H8I9J0K1L2M3N4O5P6Q7R8S9T0.A1B2C3D4E5F6G7H8I9J0K1L2M3N4O5P6Q7R8S9T0.
        </pre>
    </div>
</body>
</html>
